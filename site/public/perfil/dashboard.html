<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/estilos-gerais.css">
    <link rel="stylesheet" href="../assets/css/sidebar.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js">
        import { Colors } from 'chart.js';
    </script>

    <title>Dashboard - Suporte</title>
</head>

<body onload="componenteMax()">
    <section class="main">

        <!-- SIDE BAR -->
        <div class="sidebar">
            <div class="perfilNome">
                <img class="iconPerfilNome" src="../assets/img/usuario-de-perfil.png" alt="">
                <span id="spanNome" class="nomePerfil"></span>
            </div>
            <div class="perfilFranquia">
                <a class="ancora" href="franquia.html"><img class="iconPerfil" src="../assets/img/franquia.png"
                        alt=""></a>
            </div>
            <div class="perfilFuncionario">
                <a class="ancora" href="func.html"><img class="iconPerfil"
                        src="../assets/img/carteira-de-identidade.png" alt=""></a>
            </div>
            <div class="perfilDefinicoes">
                <a class="ancora" href="totem.html"><img class="iconPerfil" src="../assets/img/definicoes.png"
                        alt=""></a>
            </div>
            <div class="perfilGrafico">
                <a id="ancoraGrafico" class="ancora" href="dashboard.html"><img class="iconPerfil dashboard"
                        src="../assets/img/grafico-preditivo.png" alt=""></a>
            </div>
            <button onclick="abrirChamado()" class="btnChamado">Abrir chamado</button>
            <button onclick="sairDashboard()" class="btnSair">Sair</button>
        </div>
        <!-- FIM DA SIDEBAR -->
        <div class="dash">
            <div class="inicio">
                <div class="titulo"> Dashboard - Suporte </div>
                <div class="img-mcdonalds">
                    <img src="../assets/img/mcdonalds.png" alt="Logo do Mc'Donalds">
                </div>
            </div>
            <div class="kpis">
                <div class="kpi"><h1 class="titleKpi">Horário de pico estimado</h1>
                    <h5 class="kpitexto">Utilização do totem com base no histórico</h5>
                    <h3 class="componente">Previsão de pico: 13:15h<br> Uso estimado CPU: 85%</h3>
                    <span class="datetime">Ultima atualização: 23/05/2023 19:08:08</span>
                </div>
                <div class="kpi"><h1 class="titleKpi">Uso máximo registrado da CPU</h1>
                    <h5 class="kpitexto">Registrado na última semana</h5>
                    <h3 id="componenteMaxSpan" class="componente">CPU:</h3>
                    <span class="datetime">Ultima atualização: 23/05/2023 19:08:50</span>
                </div>
                <div class="kpi"><h1 class="titleKpi">Armazenamento total de DISCOS</h1>
                    <h5 class="kpitexto">Tamanho total e utilizado em GB's</h5>
                    <h3 class="componente">Total: 500GB <br> Utilizado: 255GB</h3>
                    <span class="datetime">Ultima atualização: 23/05/2023 19:08:50</span>
                </div>
                <div class="kpi"><h1 class="titleKpi">Último componente sobre stress</h1>
                    <h5 class="kpitexto">Nos últimos registros</h5>
                    <h3 class="componente">RAM com 95%</h3>
                    <span class="datetime">Ultima atualização: 23/05/2023 19:08:50</span>
                </div>
            </div>
            <div class="graficos">
                <div class="div_chart1">
                    <div class="chart1">
                        <canvas class="canva" id="myChart1"></canvas>
                    </div>
                </div>

                <div class="div_chart1">
                    <div class="chart1">
                        <canvas id="myChart2"></canvas>
                    </div>
                </div>
            </div>
            <div class="graficos">
                <div class="div_chart1">
                    <div class="chart1">
                        <canvas id="myChart3"></canvas>
                    </div>
                </div>
                <div class="div_chart1">
                    <div class="chart1">
                        <canvas class="graph4" id="myChart4"></canvas>
                    </div>
                </div>
            </div>
        </div>

</body>

</html>

<script>
     if(sessionStorage.CARGO == "suporte"){
        var ancora = document.getElementById("ancoraGrafico");
        ancora.href = "selecaoTotem.html";
    } else {
        ancora.href = "dashGerente.html";
    }

    var idTotem = sessionStorage.ID_TOTEM;

    function componenteMax() {
        // ATUALIZAR AQUI PARA DEPOIS O SESSION STORAGE

        //aguardar();
        fetch(`/totem/componenteMax/${idTotem}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var span = document.getElementById("componenteMaxSpan");
                    span.innerHTML = `CPU: ${resposta[0].maximoProcessador}%`

                    // finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            // finalizarAguardar();
        });
    }


    var nomes = sessionStorage.NOME_USUARIO;
    spanNome.innerHTML = nomes;

    function abrirChamado() {
  window.location.href = 'https://toodtech.auvo.com.br/Ticket/Novo'; 
}

    // Função para sair da Dashboard
    function sairDashboard() {
        window.location = "../index.html"
    }


    const ctx1 = document.getElementById('myChart1');
    const ctx2 = document.getElementById('myChart2');
    const ctx3 = document.getElementById('myChart3');
    const ctx4 = document.getElementById('myChart4');

    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'],
            datasets: [{
                label: 'Utilização Processador',
                data: [12, 19, 3, 5, 2, 1, 10],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    new Chart(ctx2, {
        type: 'line',
        data: {
            labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'],
            datasets: [{
                label: 'Utilização Ram',
                data: [12, 19, 3, 5, 2, 1, 9],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    new Chart(ctx3, {
        type: 'line',
        data: {
            labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'],
            datasets: [{
                label: 'Utilização Disco',
                data: [12, 19, 3, 5, 2, 1, 8],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    new Chart(ctx4, {
        type: 'polarArea',
        data: {
            labels: ['CPU', 'RAM', 'DISCO'],
            datasets: [{
                label: 'Utilização Disco',
                data: [4, 6, 5],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>